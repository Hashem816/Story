"""
Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª
"""
import sys
sys.path.insert(0, '.')

def test_imports():
    """Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯Ø§Øª"""
    print("ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯Ø§Øª...")
    try:
        from database import manager, models
        from services import order_service, permission_service, analytics_service
        from config import settings
        from utils import keyboards, translations
        print("âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯Ø§Øª Ù†Ø§Ø¬Ø­Ø©")
        return True
    except Exception as e:
        print(f"âŒ ÙØ´Ù„ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯: {e}")
        return False

def test_services():
    """Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø®Ø¯Ù…Ø§Øª"""
    print("\nğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø®Ø¯Ù…Ø§Øª...")
    try:
        from services.order_service import order_service
        from services.permission_service import permission_service
        from services.analytics_service import analytics_service
        
        # Ø§Ø®ØªØ¨Ø§Ø± Permission Service
        assert permission_service.is_super_admin('SUPER_ADMIN') == True
        assert permission_service.is_operator('OPERATOR') == True
        assert permission_service.is_support('SUPPORT') == True
        assert permission_service.has_permission('SUPER_ADMIN', 'manage_products') == True
        assert permission_service.has_permission('USER', 'manage_products') == False
        
        print("âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø¯Ù…Ø§Øª ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­")
        return True
    except Exception as e:
        print(f"âŒ ÙØ´Ù„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø®Ø¯Ù…Ø§Øª: {e}")
        import traceback
        traceback.print_exc()
        return False

def test_config():
    """Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª"""
    print("\nğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª...")
    try:
        from config.settings import UserRole, OrderStatus, ProductType, StoreMode
        
        assert hasattr(UserRole, 'SUPER_ADMIN')
        assert hasattr(OrderStatus, 'COMPLETED')
        assert hasattr(ProductType, 'MANUAL')
        assert hasattr(StoreMode, 'MAINTENANCE')
        
        print("âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…ÙˆØ¬ÙˆØ¯Ø©")
        return True
    except Exception as e:
        print(f"âŒ ÙØ´Ù„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª: {e}")
        return False

def test_handlers():
    """Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø§Øª"""
    print("\nğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø§Øª...")
    try:
        from handlers import products, payments, user, admin_stats
        
        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù€ routers
        assert hasattr(products, 'router')
        assert hasattr(payments, 'router')
        assert hasattr(user, 'router')
        assert hasattr(admin_stats, 'router')
        
        print("âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ù…ÙˆØ¬ÙˆØ¯Ø©")
        return True
    except Exception as e:
        print(f"âŒ ÙØ´Ù„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø§Øª: {e}")
        import traceback
        traceback.print_exc()
        return False

def main():
    """ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª"""
    print("=" * 50)
    print("ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø´Ø§Ù…Ù„")
    print("=" * 50)
    
    results = []
    results.append(("Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯Ø§Øª", test_imports()))
    results.append(("Ø§Ù„Ø®Ø¯Ù…Ø§Øª", test_services()))
    results.append(("Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª", test_config()))
    results.append(("Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø§Øª", test_handlers()))
    
    print("\n" + "=" * 50)
    print("ğŸ“Š Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±")
    print("=" * 50)
    
    for name, result in results:
        status = "âœ… Ù†Ø¬Ø­" if result else "âŒ ÙØ´Ù„"
        print(f"{name}: {status}")
    
    all_passed = all(r[1] for r in results)
    
    print("\n" + "=" * 50)
    if all_passed:
        print("ğŸ‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù†Ø¬Ø­Øª!")
    else:
        print("âš ï¸ Ø¨Ø¹Ø¶ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ÙØ´Ù„Øª")
    print("=" * 50)
    
    return all_passed

if __name__ == "__main__":
    success = main()
    sys.exit(0 if success else 1)
